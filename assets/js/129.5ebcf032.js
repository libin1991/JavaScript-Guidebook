(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{444:function(t,e,_){"use strict";_.r(e);var i=_(0),r=Object(i.a)({},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("div",{staticClass:"content"},[t._m(0),t._v(" "),_("p",[t._v("跨域资源共享（CORS：Cross-Origin Resource Sharing）是一种机制，它使用额外的 HTTP 头来告诉浏览器，让运行在相同域（Origin）上的 Web 应用被准许访问来自不同源服务器上的指定的资源（也即是 "),_("router-link",{attrs:{to:"./../frontend-security/same-origin-policy.html"}},[t._v("同源策略")]),t._v(" 的 HTTP 解决方案）。当一个资源从与该资源本身所在的服务器"),_("strong",[t._v("不同的域、协议或端口")]),t._v("请求一个资源时，资源会发起一个"),_("strong",[t._v("跨域 HTTP 请求")]),t._v("。")],1),t._v(" "),_("p",[t._v("CORS 机制是为了在认可用户发起的请求的同时，阻止恶意注入脚本；并在以下情况发起的 HTTP 请求时触发：")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),_("p",[t._v("浏览器将 CORS 请求分成两类：简单请求（simple request）和非简单请求（not-so-simple request）。")]),t._v(" "),t._m(3),t._v(" "),_("p",[t._v("只要满足以下两大条件，就属于简单请求：")]),t._v(" "),_("p",[t._v("请求方法是以下三种方法之一")]),t._v(" "),t._m(4),t._v(" "),_("p",[t._v("HTTP 的首部字段不超出以下几种字段")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),_("p",[t._v("非简单请求需要满足使用以下任意方法的条件：")]),t._v(" "),t._m(7),t._v(" "),_("p",[t._v("设置了对 CORS 安全的首部字段集合之外的其他首部字段。")]),t._v(" "),t._m(8),t._v(" "),_("p",[t._v("Content-Type 的值不属于下列之一：")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),_("p",[t._v("预请求是 OPTIONS 请求，浏览器会自动添加 Access-Control-Allow-Headers 和 Access-Control-Allow-Methods")]),t._v(" "),_("p",[t._v("需要服务端返回的响应头 Access-Control-Allow-Headers、Access-Control-Allow-Methods 和 Access-Control-Allow-Origin。")]),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),_("p",[t._v("预请求完之后就可以发送正常请求了，正常请求的步骤与简单请求一致，也需要添加 Access-Control-Allow-Origin 响应头。")]),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),_("p",[t._v("跨域资源共享标准（Cross-Origin Sharing Standard）允许在下列场景中使用跨域 HTTP 请求：")]),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),_("hr"),t._v(" "),t._m(20),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS",target:"_blank",rel:"noopener noreferrer"}},[t._v("MDN HTTP Access control CORS"),_("OutboundLink")],1)]),t._v(" "),_("li",[_("a",{attrs:{href:"https://juejin.im/post/5a97b5a3f265da23766ab19a",target:"_blank",rel:"noopener noreferrer"}},[t._v("理解 CORS"),_("OutboundLink")],1)]),t._v(" "),_("li",[_("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2016/04/cors.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("阮一峰 跨域资源共享 CORS 详解"),_("OutboundLink")],1)]),t._v(" "),_("li",[_("a",{attrs:{href:"https://juejin.im/post/58f816198d6d81005874fd97",target:"_blank",rel:"noopener noreferrer"}},[t._v("由同源策略到前端跨域"),_("OutboundLink")],1)])])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"跨域资源共享"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#跨域资源共享","aria-hidden":"true"}},[this._v("#")]),this._v(" 跨域资源共享")])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ul",[_("li",[t._v("不同的域：比如从 "),_("code",[t._v("example.com")]),t._v(" 调用 "),_("code",[t._v("api.com")])]),t._v(" "),_("li",[t._v("不同的子域：比如从 "),_("code",[t._v("example.com")]),t._v(" 调用 "),_("code",[t._v("api.example.com")])]),t._v(" "),_("li",[t._v("不同的端口：比如从 "),_("code",[t._v("example.com")]),t._v(" 调用 "),_("code",[t._v("example.com:3001")])]),t._v(" "),_("li",[t._v("不同的协议：比如从 "),_("code",[t._v("https://example.com")]),t._v(" 调用 "),_("code",[t._v("http://example.com")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"实现条件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现条件","aria-hidden":"true"}},[this._v("#")]),this._v(" 实现条件")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"简单请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简单请求","aria-hidden":"true"}},[this._v("#")]),this._v(" 简单请求")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("HEAD")]),this._v(" "),e("li",[this._v("GET")]),this._v(" "),e("li",[this._v("POST")])])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ul",[_("li",[t._v("Accept")]),t._v(" "),_("li",[t._v("Accept-Language")]),t._v(" "),_("li",[t._v("Content-Language")]),t._v(" "),_("li",[t._v("Last-Event-ID")]),t._v(" "),_("li",[t._v("Content-Type\n"),_("ul",[_("li",[_("code",[t._v("application/x-www-form-urlencoded")])]),t._v(" "),_("li",[_("code",[t._v("multipart/form-data")])]),t._v(" "),_("li",[_("code",[t._v("text/plain")])])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"非简单请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#非简单请求","aria-hidden":"true"}},[this._v("#")]),this._v(" 非简单请求")])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ul",[_("li",[t._v("PUT")]),t._v(" "),_("li",[t._v("DELETE")]),t._v(" "),_("li",[t._v("CONNECT")]),t._v(" "),_("li",[t._v("OPTIONS")]),t._v(" "),_("li",[t._v("TRACE")]),t._v(" "),_("li",[t._v("PATCH")])])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ul",[_("li",[t._v("Accept")]),t._v(" "),_("li",[t._v("Accept-Language")]),t._v(" "),_("li",[t._v("Content-Language")]),t._v(" "),_("li",[t._v("Content-Type")]),t._v(" "),_("li",[t._v("DPR")]),t._v(" "),_("li",[t._v("Downlink")]),t._v(" "),_("li",[t._v("Save-Data")]),t._v(" "),_("li",[t._v("Viewport-Width")]),t._v(" "),_("li",[t._v("Width")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("application/x-www-form-urlencoded")]),this._v(" "),e("li",[this._v("multipart/form-data")]),this._v(" "),e("li",[this._v("text/plain")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"预请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#预请求","aria-hidden":"true"}},[this._v("#")]),this._v(" 预请求")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("除了Access-Control-Allow-Origin 是必须的之外，其他两种只有在不符合简单请求需要的时候服务器才需要添加，比如在简单请求的基础上自定义了一个请求头 "),e("code",[this._v("X-xx-name: chris")]),this._v("，那么服务器只需要在响应头中添加 Access-Control-Allow-Headers。每种响应头都可以使用 "),e("code",[this._v("*")]),this._v(" 通配符来表示所有。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"正常请求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#正常请求","aria-hidden":"true"}},[this._v("#")]),this._v(" 正常请求")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"减少预请求次数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#减少预请求次数","aria-hidden":"true"}},[this._v("#")]),this._v(" 减少预请求次数")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("可以通过设置 Access-Control-Max-Aage 来减少预请求的次数，需要包含在预请求的响应头中，指定在该时间内预请求验证有效，不必每次都进行预请求，它的单位是 "),e("code",[this._v("s")]),this._v("。如 "),e("code",[this._v("Access-Control-Max-Age: 1728000")]),this._v("，即有效期为 20 天。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"其他限制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#其他限制","aria-hidden":"true"}},[this._v("#")]),this._v(" 其他限制")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("请求头限制")]),this._v(" "),e("li",[this._v("XMLHttpRequestUpload 对象均没有注册任何事件监听器")]),this._v(" "),e("li",[this._v("请求中没有使用 ReadableStream 对象")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"使用场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用场景","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用场景")])},function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ul",[_("li",[t._v("前文提到的由 XMLHttpRequest 或 Fetch 发起的跨域 HTTP 请求")]),t._v(" "),_("li",[t._v("Web 字体（CSS 通过 "),_("code",[t._v("@font-face")]),t._v(" 使用跨域字体资源）")]),t._v(" "),_("li",[t._v("WebGL 贴图")]),t._v(" "),_("li",[t._v("使用 "),_("code",[t._v("drawImage")]),t._v(" 将 "),_("code",[t._v("Images/viedo")]),t._v(" 画面绘制到 Canvas")]),t._v(" "),_("li",[t._v("样式表（使用 CSSOM ）")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("⚠️注意：HTML 中 "),e("code",[this._v("<link>")]),this._v("、"),e("code",[this._v("<script>")]),this._v("、"),e("code",[this._v("<img>")]),this._v(" 等标签自带连接属性进行 HTTP 请求是能够无视同源策略的。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("参考资料：")])])}],!1,null,null,null);e.default=r.exports}}]);