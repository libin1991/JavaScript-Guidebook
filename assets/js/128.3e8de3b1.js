(window.webpackJsonp=window.webpackJsonp||[]).push([[128],{442:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),a("p",[t._v("XSS 攻击全称跨站脚本攻击（Cross-Site Scripting），通常指的是通过利用网页开发时留下的漏洞，通过巧妙的方法在目标网站 HTML 页面注入恶意指令代码到网页，使用用户加载并执行攻击者恶意制造的网页程序。这些恶意网页程序通常是 JavaScript，但实际上也可以包括 Java、VBScript、ActivieX、Flash 或者甚至是普通的 HTML。攻击成功后，攻击者可能得到更高的权限（如执行一些操作）、私密网页内容、会话和 Cookie 等各种内容。")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),a("p",[t._v("这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。")]),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),a("p",[t._v("反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。")]),t._v(" "),a("p",[t._v("反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。")]),t._v(" "),a("p",[t._v("由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。")]),t._v(" "),a("p",[t._v("POST 的内容也可以触发反射型 XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。")]),t._v(" "),t._m(12),t._v(" "),a("p",[t._v("DOM 型 XSS 的攻击步骤：")]),t._v(" "),t._m(13),t._v(" "),a("p",[t._v("DOM 型 XSS 跟前两种 XSS 的区别：DOM 型 XSS 攻击中，取出和执行恶意代码由浏览器端完成，属于前端 JavaScript 自身的安全漏洞，而其他两种 XSS 都属于服务端的安全漏洞。")]),t._v(" "),t._m(14),t._v(" "),a("p",[t._v("XSS 攻击有两大要素：")]),t._v(" "),t._m(15),t._v(" "),a("p",[t._v("Chrome 浏览器自带防御，可拦截反射型 XSS（HTML 内容和属性），JS 和富文本无法拦截。")]),t._v(" "),t._m(16),t._v(" "),a("p",[t._v("存储型和反射型 XSS 都是在服务端取出恶意代码后，插入到响应 HTML 里的，攻击者刻意编写的「数据」被内嵌到「代码」中，被浏览器所执行。")]),t._v(" "),a("p",[t._v("预防这两种漏洞，有两种常见做法：")]),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),a("p",[t._v("纯前端渲染的过程：")]),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._v(" "),a("p",[t._v("在很多内部、管理系统中，采用纯前端渲染是非常合适的。但对于性能要求高，或有 SEO 需求的页面，我们仍然要面对拼接 HTML 的问题。")]),t._v(" "),t._m(22),t._v(" "),a("p",[t._v("如果拼接 HTML 是必要的，就需要采用合适的转义库，对 HTML 模板各处插入点进行充分的转义。")]),t._v(" "),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),a("p",[t._v("所以要完善 XSS 防护措施，我们要使用更完善更细致的转义策略。")]),t._v(" "),a("p",[t._v("例如 Java 工程里，常用的转义库为 "),a("code",[t._v("org.owasp.encoder")]),t._v("。以下代码引用自 "),a("a",{attrs:{href:"https://link.juejin.im?target=https%3A%2F%2Fwww.owasp.org%2Findex.php%2FOWASP_Java_Encoder_Project%23tab%3DUse_the_Java_Encoder_Project",target:"_blank",rel:"noopener noreferrer"}},[t._v("org.owasp.encoder 的官方说明"),a("OutboundLink")],1),t._v("。")]),t._v(" "),t._m(27),a("p",[t._v("可见，HTML 的编码是十分复杂的，在不同的上下文里要使用相应的转义规则。")]),t._v(" "),t._m(28),t._v(" "),a("p",[t._v("DOM 型 XSS 攻击，实际上就是网站前端 JavaScript 代码本身不够严谨，把不可信的数据当作代码执行了。")]),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),t._m(32),a("p",[t._v("如果项目中有用到这些的话，一定要避免在字符串中拼接不可信数据。")]),t._v(" "),t._m(33),t._v(" "),a("p",[t._v("内容安全策略（Content Security Policy，简称 CSP）是一种可信白名单作机制，来限制网站中是否可以包含某来源内容。")]),t._v(" "),a("p",[t._v("严格的 CSP 在 XSS 的防范中可以起到下列的作用：")]),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),a("p",[t._v("对于不受信任的输入，都应该限定一个合理的长度。虽然无法完全防止 XSS 发生，但可以增加 XSS 攻击的难度。")]),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),a("hr"),t._v(" "),t._m(38),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://juejin.im/post/5bad9140e51d450e935c6d64",target:"_blank",rel:"noopener noreferrer"}},[t._v("前端安全系列：如何防止 XSS 攻击?"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://yq.aliyun.com/articles/638829",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web 安全系列：XSS 攻击基础及原理"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://yq.aliyun.com/articles/638935?spm=a2c4e.11153940.blogcont638829.21.74d874d3lHE0qK",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web 安全系列：XSS 攻击进阶"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://yq.aliyun.com/articles/641535?spm=a2c4e.11153940.blogcont638935.16.6e757039SLyW6B",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web 安全系列：XSS 攻击进阶"),a("OutboundLink")],1)])])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"xss-攻击"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xss-攻击","aria-hidden":"true"}},[this._v("#")]),this._v(" XSS 攻击")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("常见 XSS 攻击的危害")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ol",[a("li",[t._v("盗取各类用户账号")]),t._v(" "),a("li",[t._v("控制企业数据，包括读取、篡改、添加、删除企业敏感数据的能力")]),t._v(" "),a("li",[t._v("盗窃企业重要的具有商业价值的资料")]),t._v(" "),a("li",[t._v("非法转账")]),t._v(" "),a("li",[t._v("强制发送电子邮件")]),t._v(" "),a("li",[t._v("网站挂马")]),t._v(" "),a("li",[t._v("控制受害者机器向其他网站发起攻击")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"分类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#分类","aria-hidden":"true"}},[this._v("#")]),this._v(" 分类")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"存储型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#存储型","aria-hidden":"true"}},[this._v("#")]),this._v(" 存储型")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("存储型 XSS 攻击又称为"),s("strong",[this._v("持久性跨站点脚本攻击")]),this._v("，它一般发生在 XSS 攻击向量（一般指 XSS 攻击代码）存储在网站数据库，当一个页面被用户打开的时候执行。持久的 XSS 相比非持久型 XSS 攻击危害性更大，容易造成蠕虫，因为每当用户打开页面，查看内容时脚本将自动执行。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("攻击步骤")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("攻击者将恶意代码提交到目标网站的数据库中")]),this._v(" "),s("li",[this._v("用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器")]),this._v(" "),s("li",[this._v("用户浏览器接收到响应后解析之行，混在其中的恶意代码也被执行")]),this._v(" "),s("li",[this._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"反射型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#反射型","aria-hidden":"true"}},[this._v("#")]),this._v(" 反射型")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("反射型 XSS 攻击又称为"),s("strong",[this._v("非持久性跨站点脚本攻击")]),this._v("。漏洞产生的原因是攻击者注入的数据反映在响应中。反射型 XSS 攻击要求用户访问一个被攻击者篡改后的链接，用户访问该链接时，被植入的攻击脚本被用户游览器执行，从而达到攻击目的。通过 URL 参数直接注入，然后在响应的数据中包含着危险的代码。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("攻击步骤")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("攻击者构造出特殊的 URL，其中包含恶意代码")]),this._v(" "),s("li",[this._v("用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器")]),this._v(" "),s("li",[this._v("用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行")]),this._v(" "),s("li",[this._v("恶意代码窃取用户数据并发送到攻击者的网站，活着冒充用户的行为，调用目标网站接口执行攻击者指定的操作")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"dom-型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dom-型","aria-hidden":"true"}},[this._v("#")]),this._v(" DOM 型")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("攻击者构造出特殊的 URL，其中包含恶意代码")]),this._v(" "),s("li",[this._v("用户打开带有恶意代码的 URL")]),this._v(" "),s("li",[this._v("用户浏览器接收到响应后解析执行，前端 JavaScript 取出 URL 中的恶意代码并执行")]),this._v(" "),s("li",[this._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"防御策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#防御策略","aria-hidden":"true"}},[this._v("#")]),this._v(" 防御策略")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("攻击者提交恶意代码")]),this._v(" "),s("li",[this._v("浏览器执行恶意代码")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"预防存储型和反射型-xss-攻击"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#预防存储型和反射型-xss-攻击","aria-hidden":"true"}},[this._v("#")]),this._v(" 预防存储型和反射型 XSS 攻击")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("改成纯前端渲染，把代码和数据分隔开。")]),this._v(" "),s("li",[this._v("对 HTML 做充分转义。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"纯前端渲染"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#纯前端渲染","aria-hidden":"true"}},[this._v("#")]),this._v(" 纯前端渲染")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("浏览器先加载一个静态 HTML，此 HTML 中不包含任何跟业务相关的数据。")]),this._v(" "),s("li",[this._v("然后浏览器执行 HTML 中的 JavaScript。")]),this._v(" "),s("li",[this._v("JavaScript 通过 Ajax 加载业务数据，调用 DOM API 更新到页面上。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在纯前端渲染中，我们会明确的告诉浏览器：下面要设置的内容是文本（"),s("code",[this._v(".innerText")]),this._v("），还是属性（"),s("code",[this._v(".setAttribute")]),this._v("），还是样式（"),s("code",[this._v(".style")]),this._v("）等等。浏览器不会被轻易的被欺骗，执行预期外的代码了。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("但纯前端渲染还需注意避免 DOM 型 XSS 漏洞（例如 "),s("code",[this._v("onload")]),this._v(" 事件和 "),s("code",[this._v("href")]),this._v(" 中的 "),s("code",[this._v("javascript:xxx")]),this._v(" 等，请参考下文「预防 DOM 型 XSS 攻击」部分）。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"转义-html"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#转义-html","aria-hidden":"true"}},[this._v("#")]),this._v(" 转义 HTML")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("字符串类型的数据，需要针对 "),a("code",[t._v("<")]),t._v("、"),a("code",[t._v(">")]),t._v("、"),a("code",[t._v("/")]),t._v("、"),a("code",[t._v("'")]),t._v("、"),a("code",[t._v('"')]),t._v(" 和 "),a("code",[t._v("&")]),t._v(" 五个字符进行实体化转义。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("table",[a("thead",[a("tr",[a("th",[t._v("特殊字符")]),t._v(" "),a("th",[t._v("实体编码")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("&")])]),t._v(" "),a("td",[a("code",[t._v("&amp;")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("<")])]),t._v(" "),a("td",[a("code",[t._v("&lt;")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v(">")])]),t._v(" "),a("td",[a("code",[t._v("&gt;")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v('"')])]),t._v(" "),a("td",[a("code",[t._v("&quot;")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("'")])]),t._v(" "),a("td",[a("code",[t._v("&#x27;")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/")])]),t._v(" "),a("td",[a("code",[t._v("&#x2F;")])])])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("常用的模板引擎，如 doT.js、ejs、FreeMarker 等，对于 HTML 转义通常只有一个规则，就是把 "),a("code",[t._v("<")]),t._v("、"),a("code",[t._v(">")]),t._v("、"),a("code",[t._v("/")]),t._v("、"),a("code",[t._v("'")]),t._v("、"),a("code",[t._v('"')]),t._v(" 和 "),a("code",[t._v("&")]),t._v(" 这几个字符转义掉，确实能起到一定的 XSS 防护作用，但并不完善：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("table",[a("thead",[a("tr",[a("th",[t._v("XSS 安全漏洞")]),t._v(" "),a("th",[t._v("简单转义是否有防护作用")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("HTML 标签文字内容")]),t._v(" "),a("td",[t._v("有")])]),t._v(" "),a("tr",[a("td",[t._v("HTML 属性值")]),t._v(" "),a("td",[t._v("有")])]),t._v(" "),a("tr",[a("td",[t._v("CSS 内联样式")]),t._v(" "),a("td",[t._v("无")])]),t._v(" "),a("tr",[a("td",[t._v("内联 JavaScript")]),t._v(" "),a("td",[t._v("无")])]),t._v(" "),a("tr",[a("td",[t._v("内联 JSON")]),t._v(" "),a("td",[t._v("无")])]),t._v(" "),a("tr",[a("td",[t._v("跳转链接")]),t._v(" "),a("td",[t._v("无")])])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- HTML 标签内文字内容 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("<%= Encode.forHtml(UNTRUSTED) %>"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- HTML 标签属性值 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("<%= Encode.forHtml(UNTRUSTED) %>"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- CSS 属性值 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token style-attr language-css"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('="')]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token property"}},[t._v("width")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("<= Encode."),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("forCssString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UNTRUSTED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" %>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- CSS URL --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token style-attr language-css"}},[a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("style")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('="')]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token property"}},[t._v("background")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("<= Encode.forCss"),a("span",{pre:!0,attrs:{class:"token url"}},[t._v("Url(UNTRUSTED)")]),t._v(" %>")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- JavaScript 内联代码块 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" msg "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"<%= Encode.forJavaScript(UNTRUSTED) %>"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- JavaScript 内联代码块内嵌 JSON --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" __INITIAL_STATE__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<%= Encoder.forJavaScript(data.to_json) %>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- HTML 标签内联监听器 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onclick")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("alert('<%= Encode.forJavaScript(UNTRUSTED) %>');"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  click me\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- URL 参数 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/search?value=<%= Encode.forUriComponent(UNTRUSTED) %>&order=1#top"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- URL 路径 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("/page/<%= Encode.forUriComponent(UNTRUSTED) %>"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('\x3c!--\n  URL.\n  注意：要根据项目情况进行过滤，禁止掉 "javascript:" 链接、非法 scheme 等\n--\x3e')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v('<%=\n  urlValidator.isValid(UNTRUSTED) ?\n    Encode.forHtml(UNTRUSTED) :\n    "/404"\n%>'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  link\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"预防-dom-型-xss-攻击"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#预防-dom-型-xss-攻击","aria-hidden":"true"}},[this._v("#")]),this._v(" 预防 DOM 型 XSS 攻击")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("在使用 "),a("code",[t._v(".innerHTML")]),t._v("、"),a("code",[t._v(".outerHTML")]),t._v("、"),a("code",[t._v("document.write()")]),t._v(" 时要特别小心，不要把不可信的数据作为 HTML 插到页面上，而应尽量使用 "),a("code",[t._v(".textContent")]),t._v("、"),a("code",[t._v(".setAttribute()")]),t._v(" 等。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("如果用 Vue/React 技术栈，并且不使用 "),a("code",[t._v("v-html")]),t._v("/"),a("code",[t._v("dangerouslySetInnerHTML")]),t._v(" 功能，就在前端 render 阶段避免 "),a("code",[t._v("innerHTML")]),t._v("、"),a("code",[t._v("outerHTML")]),t._v(" 的 XSS 隐患。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("DOM 中的内联事件监听器，如 "),a("code",[t._v("location")]),t._v("、"),a("code",[t._v("onclick")]),t._v("、"),a("code",[t._v("onerror")]),t._v("、"),a("code",[t._v("onload")]),t._v("、"),a("code",[t._v("onmouseover")]),t._v(" 等，"),a("code",[t._v("<a>")]),t._v(" 标签的 "),a("code",[t._v("href")]),t._v(" 属性，JavaScript 的 "),a("code",[t._v("eval()")]),t._v("、"),a("code",[t._v("setTimeout()")]),t._v("、"),a("code",[t._v("setInterval()")]),t._v(" 等，都能把字符串作为代码运行。如果不可信的数据拼接到字符串中传递给这些 API，很容易产生安全隐患，请务必避免。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 内联事件监听器中包含恶意代码 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onclick")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UNTRUSTED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onerror")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UNTRUSTED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("data:image/png,"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 链接内包含恶意代码 --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UNTRUSTED"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("1"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}},[a("span",{pre:!0,attrs:{class:"token language-javascript"}},[t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setTimeout()/setInterval() 中调用恶意代码")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UNTRUSTED"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UNTRUSTED"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// location 调用恶意代码")]),t._v("\nlocation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("href "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'UNTRUSTED'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// eval() 中调用恶意代码")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("eval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"UNTRUSTED"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"content-security-policy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#content-security-policy","aria-hidden":"true"}},[this._v("#")]),this._v(" Content Security Policy")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("禁止加载外域代码，防止复杂的攻击逻辑")]),t._v(" "),a("li",[t._v("禁止外域提交，网站被攻击后，用户的数据不会泄漏到外域")]),t._v(" "),a("li",[t._v("禁止内联脚本执行（规则较严格，目前发现 Github 使用）")]),t._v(" "),a("li",[t._v("禁止未授权的脚本执行（新特性，Google Map 移动版在使用）")]),t._v(" "),a("li",[t._v("合理使用上报可以及时发现 XSS，利于尽快修复问题")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"输入内容长度限制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#输入内容长度限制","aria-hidden":"true"}},[this._v("#")]),this._v(" 输入内容长度限制")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"其他安全措施"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#其他安全措施","aria-hidden":"true"}},[this._v("#")]),this._v(" 其他安全措施")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("HTTP-only Cookie：禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie")]),this._v(" "),s("li",[this._v("验证码：防止脚本冒充用户提交危险操作")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("strong",[this._v("参考资料：")])])}],!1,null,null,null);s.default=e.exports}}]);